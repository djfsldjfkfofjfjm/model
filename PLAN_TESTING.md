# План тестирования FinancialDashboard

## 1. Модульные тесты (Unit Tests)

### 1.1. Тестирование бизнес-логики

#### Расчет финансовой модели
- **Тест**: `calculateFinancialModel.test.ts`
- **Описание**: Тестирование основной функции расчета финансовой модели
- **Тестовые случаи**:
  - Базовый сценарий с дефолтными параметрами
  - Сценарий с высоким churn rate (проверка корректности расчетов оттока)
  - Сценарий с нулевыми клиентами (граничный случай)
  - Сценарий с большим количеством клиентов (проверка масштабируемости)
  - Проверка расчета налогов для обоих режимов (оптимистичный/пессимистичный)

#### Клиентская логика
- **Тест**: `clientManagement.test.ts`
- **Описание**: Тестирование функций управления клиентской базой
- **Тестовые случаи**:
  - Корректность расчета активных клиентов с учетом оттока
  - Проверка корректности распределения клиентов по тарифам
  - Тестирование граничных случаев (0 клиентов, 100% отток)

#### Расчеты Upsell
- **Тест**: `upsellCalculations.test.ts`
- **Описание**: Тестирование расчетов дополнительных продаж
- **Тестовые случаи**:
  - Проверка выручки от всех типов upsell
  - Проверка корректности расчета процентного соотношения
  - Тестирование граничных значений (0% upsell, очень высокий upsell)

#### Налоговые расчеты
- **Тест**: `taxCalculations.test.ts`
- **Описание**: Тестирование налоговых расчетов
- **Тестовые случаи**:
  - Корректность расчета для оптимистичного сценария (9%)
  - Корректность расчета для пессимистичного сценария (35%)
  - Проверка расчета при нулевой выручке

### 1.2. Тестирование компонентов

#### EditableCell
- **Тест**: `EditableCell.test.tsx`
- **Описание**: Тестирование компонента редактируемой ячейки
- **Тестовые случаи**:
  - Корректное отображение начального значения
  - Обработка ввода допустимых значений
  - Обработка ввода недопустимых значений (за пределами min/max)
  - Проверка вызова callback при изменении значения

#### InfoTooltip
- **Тест**: `InfoTooltip.test.tsx`
- **Описание**: Тестирование компонента подсказки
- **Тестовые случаи**:
  - Корректное отображение текста подсказки
  - Появление подсказки при наведении мыши
  - Исчезновение подсказки при уходе мыши
  - Правильное позиционирование элемента подсказки

#### MetricCard
- **Тест**: `MetricCard.test.tsx`
- **Описание**: Тестирование компонента карточки метрики
- **Тестовые случаи**:
  - Корректное отображение заголовка и значения
  - Правильное форматирование числовых значений
  - Отображение дополнительной информации (subValue)
  - Правильное применение цветовой схемы

### 1.3. Тестирование хуков

#### useFinancialCalculations
- **Тест**: `useFinancialCalculations.test.ts`
- **Описание**: Тестирование хука для финансовых расчетов
- **Тестовые случаи**:
  - Корректный расчет при инициализации
  - Перерасчет при изменении зависимостей
  - Проверка оптимизации (избежание лишних перерасчетов)

#### useClientManagement
- **Тест**: `useClientManagement.test.ts`
- **Описание**: Тестирование хука управления клиентами
- **Тестовые случаи**:
  - Правильное обновление данных при изменении клиентской базы
  - Корректная работа с массивами клиентов
  - Обработка краевых случаев

## 2. Интеграционные тесты

### 2.1. Тестирование взаимодействия компонентов

#### Взаимодействие настроек с графиками
- **Тест**: `SettingsGraphsInteraction.test.tsx`
- **Описание**: Проверка обновления графиков при изменении настроек
- **Тестовые случаи**:
  - Изменение налогового режима -> обновление графика прибыли
  - Изменение параметров клиентов -> обновление графика клиентов
  - Изменение ФОТ -> обновление графика расходов

#### Обновление табличных данных
- **Тест**: `TablesDataUpdate.test.tsx`
- **Описание**: Проверка обновления таблиц при изменении входных данных
- **Тестовые случаи**:
  - Добавление новых клиентов -> обновление таблицы клиентов
  - Изменение параметров модели -> обновление итоговых показателей

### 2.2. Тестирование контекста

#### Обновление через контекст
- **Тест**: `FinancialContext.test.tsx`
- **Описание**: Проверка обновления компонентов через контекст
- **Тестовые случаи**:
  - Изменение глобального состояния через действия
  - Проверка обновления подписанных компонентов
  - Проверка изоляции компонентов, не зависящих от контекста

#### Работа редюсеров
- **Тест**: `FinancialReducers.test.ts`
- **Описание**: Проверка работы редюсеров
- **Тестовые случаи**:
  - Обработка различных типов действий
  - Проверка иммутабельности обновления состояния
  - Комбинирование нескольких действий

## 3. E2E тесты

### 3.1. Тестирование пользовательских сценариев

#### Переключение вкладок
- **Тест**: `TabNavigation.test.tsx`
- **Описание**: Проверка корректной работы навигации по вкладкам
- **Тестовые случаи**:
  - Переключение с Dashboard на Clients и обратно
  - Проверка корректного отображения содержимого активной вкладки
  - Сохранение состояния при переключении вкладок

#### Редактирование настроек модели
- **Тест**: `ModelParametersEdit.test.tsx`
- **Описание**: Проверка редактирования основных параметров модели
- **Тестовые случаи**:
  - Изменение налогового режима и проверка обновления расчетов
  - Изменение режима ФОТ и проверка влияния на расходы
  - Изменение churn rate и проверка изменения клиентской базы

#### Редактирование клиентских данных
- **Тест**: `ClientsDataEdit.test.tsx`
- **Описание**: Проверка редактирования данных о клиентах
- **Тестовые случаи**:
  - Добавление новых клиентов и проверка обновления графиков
  - Изменение стоимости подписки и проверка влияния на выручку
  - Массовое редактирование данных о клиентах

### 3.2. Тестирование визуализации

#### Корректное отображение графиков
- **Тест**: `ChartsRendering.test.tsx`
- **Описание**: Проверка правильного отображения графиков
- **Тестовые случаи**:
  - Проверка отображения графика доходов
  - Проверка отображения графика клиентов
  - Проверка отображения радарного графика KPI

#### Обновление графиков
- **Тест**: `ChartsUpdate.test.tsx`
- **Описание**: Проверка обновления графиков при изменении данных
- **Тестовые случаи**:
  - Изменение входных данных и проверка обновления графиков
  - Проверка анимации при обновлении данных
  - Тестирование реактивности графиков

## 4. Тесты производительности

### 4.1. Тестирование времени загрузки

#### Инициализация приложения
- **Тест**: `AppInitialization.perf.test.tsx`
- **Описание**: Измерение времени инициализации приложения
- **Тестовые случаи**:
  - Время до первого рендера (First Paint)
  - Время до интерактивности (First Interactive)
  - Время полной загрузки приложения

#### Время расчета модели
- **Тест**: `ModelCalculationTime.perf.test.ts`
- **Описание**: Измерение времени расчета финансовой модели
- **Тестовые случаи**:
  - Время базового расчета с дефолтными параметрами
  - Время расчета с большим объемом данных
  - Время обновления при изменении параметров

### 4.2. Тестирование с большим объемом данных

#### Масштабируемость клиентской базы
- **Тест**: `ClientsScalability.perf.test.ts`
- **Описание**: Проверка работы с большим количеством клиентов
- **Тестовые случаи**:
  - Тест с 100 клиентами
  - Тест с 1000 клиентами
  - Тест с 10000 клиентами (стресс-тест)

#### Расширенный период расчета
- **Тест**: `ExtendedPeriod.perf.test.ts`
- **Описание**: Тестирование расчетов на длительный период
- **Тестовые случаи**:
  - Расчет на 24 месяца
  - Расчет на 36 месяцев
  - Расчет на 60 месяцев

## 5. Регрессионные тесты

### 5.1. Сравнение результатов расчетов

#### Сравнение с эталонными значениями
- **Тест**: `ReferenceComparison.test.ts`
- **Описание**: Сравнение результатов расчетов с эталонными значениями
- **Тестовые случаи**:
  - Проверка итоговых финансовых показателей
  - Проверка данных по клиентам
  - Проверка налоговых расчетов

#### Проверка стабильности расчетов
- **Тест**: `CalculationStability.test.ts`
- **Описание**: Проверка стабильности расчетов при рефакторинге
- **Тестовые случаи**:
  - Запуск идентичных расчетов до и после рефакторинга
  - Проверка отсутствия отклонений в результатах
  - Тестирование на различных наборах данных

### 5.2. Визуальные регрессионные тесты

#### Сравнение UI до и после изменений
- **Тест**: `UIRegression.test.tsx`
- **Описание**: Сравнение снимков UI до и после рефакторинга
- **Тестовые случаи**:
  - Снимки основного дашборда
  - Снимки страницы клиентов
  - Снимки страницы финансов
  - Снимки страницы настроек Upsell

#### Проверка соответствия дизайну
- **Тест**: `DesignCompliance.test.tsx`
- **Описание**: Проверка соответствия UI дизайн-спецификации
- **Тестовые случаи**:
  - Проверка цветовой схемы
  - Проверка типографики
  - Проверка отступов и расположения элементов

## План реализации тестов

### Этап 1: Подготовка тестового окружения (1 день)
- Настройка Jest и React Testing Library
- Создание мокированных данных для тестов
- Настройка утилит для тестирования

### Этап 2: Разработка модульных тестов (2-3 дня)
- Реализация тестов для бизнес-логики
- Реализация тестов для компонентов
- Реализация тестов для хуков

### Этап 3: Разработка интеграционных тестов (1-2 дня)
- Реализация тестов взаимодействия компонентов
- Реализация тестов работы контекста

### Этап 4: Разработка E2E тестов (1-2 дня)
- Реализация тестов пользовательских сценариев
- Реализация тестов визуализации

### Этап 5: Разработка тестов производительности (1 день)
- Реализация тестов времени загрузки
- Реализация тестов с большими объемами данных

### Этап 6: Разработка регрессионных тестов (1-2 дня)
- Реализация тестов сравнения результатов
- Реализация визуальных регрессионных тестов

### Этап 7: Интеграция и автоматизация (1 день)
- Настройка автоматического запуска тестов
- Настройка отчетности по тестам
- Настройка CI/CD для тестирования